<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêç –ó–º–µ–π–∫–∞ - DynastGame</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --neon-gradient: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            --pastel-gradient: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--primary-gradient);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            overflow: hidden;
            transition: background 0.5s ease;
        }

        .main-menu {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 90vw;
            width: 400px;
            position: relative;
            overflow: hidden;
        }

        .menu-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            z-index: -1;
        }

        .snake-silhouette {
            position: absolute;
            width: 100px;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            animation: float 6s ease-in-out infinite;
        }

        .snake-silhouette:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
        .snake-silhouette:nth-child(2) { top: 60%; right: 15%; animation-delay: 2s; }
        .snake-silhouette:nth-child(3) { bottom: 30%; left: 20%; animation-delay: 4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .logo {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .coin-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 12px 20px;
            border-radius: 25px;
            margin-bottom: 25px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .coin-icon {
            font-size: 1.2em;
            animation: coinSpin 2s ease-in-out infinite;
        }

        @keyframes coinSpin {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 18px 25px;
            color: white;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .menu-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .menu-btn.primary {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .game-screen {
            display: none;
            width: 100%;
            height: 100vh;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .game-hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .hud-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .score-display, .coin-hud {
            font-size: 1.1em;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hud-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .hud-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .game-board {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .control-row {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            font-size: 1.5em;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0.95);
        }

        .shop-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .shop-menu {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 95vw;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shop-title {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .skins-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .skin-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .skin-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .skin-card.owned {
            border-color: #4ECDC4;
        }

        .skin-card.equipped {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }

        .skin-preview {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            border: 3px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.3);
        }

        .skin-name {
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .skin-price {
            font-size: 0.9em;
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
        }

        .skin-actions {
            margin-top: auto;
        }

        .skin-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            width: 100%;
        }

        .skin-btn.equip {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
        }

        .skin-btn.equip.active {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .skin-btn.buy {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .skin-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pause-screen, .game-over-screen, .settings-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .pause-menu, .game-over-menu, .settings-menu {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 90vw;
            width: 400px;
        }

        .pause-title, .game-over-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-over-title {
            color: #ff6b6b;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 600;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .pause-buttons, .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 18px;
            color: white;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .theme-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }

        .theme-btn {
            padding: 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-btn.active {
            border-color: #4ECDC4;
            background: rgba(78, 205, 196, 0.2);
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #FFD93D;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 1s ease-out forwards;
        }

        .coin-particle {
            background: #FFD700;
            animation: coinParticleFloat 1.5s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        @keyframes coinParticleFloat {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translate(var(--tx), var(--ty)) scale(1.2) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: translate(calc(var(--tx) * 1.5), calc(var(--ty) * 1.5)) scale(0) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div class="main-menu" id="mainMenu">
        <div class="menu-bg">
            <div class="snake-silhouette"></div>
            <div class="snake-silhouette"></div>
            <div class="snake-silhouette"></div>
        </div>
        
        <div class="logo">üêç</div>
        <div class="subtitle">–ó–º–µ–π–∫–∞: –°–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ</div>
        
        <div class="coin-display">
            <span class="coin-icon">ü™ô</span>
            <span id="totalCoins">0</span>
        </div>
        
        <div class="menu-buttons">
            <button class="menu-btn primary" onclick="startGame()">
                <span>üéÆ</span> –ò–≥—Ä–∞—Ç—å
            </button>
            <button class="menu-btn" onclick="showScreen('settingsScreen')">
                <span>‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            <button class="menu-btn" onclick="showScreen('shopScreen')">
                <span>üé®</span> –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤
            </button>
            <button class="menu-btn" onclick="showRecords()">
                <span>üèÜ</span> –†–µ–∫–æ—Ä–¥—ã
            </button>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div class="game-screen" id="gameScreen">
        <div class="game-hud">
            <div class="hud-stats">
                <div class="score-display">üéØ <span id="currentScore">0</span></div>
                <div class="coin-hud"><span class="coin-icon">ü™ô</span> <span id="currentCoins">0</span></div>
            </div>
            <button class="hud-btn" onclick="togglePause()">‚è∏Ô∏è</button>
        </div>
        
        <div class="game-board">
            <canvas id="gameCanvas"></canvas>
            <div class="particles" id="particles"></div>
        </div>
        
        <div class="controls">
            <div class="control-row">
                <button class="control-btn" onclick="changeDirection('up')">‚¨ÜÔ∏è</button>
            </div>
            <div class="control-row">
                <button class="control-btn" onclick="changeDirection('left')">‚¨ÖÔ∏è</button>
                <button class="control-btn" onclick="changeDirection('down')">‚¨áÔ∏è</button>
                <button class="control-btn" onclick="changeDirection('right')">‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ -->
    <div class="shop-screen" id="shopScreen">
        <div class="shop-menu">
            <div class="shop-title">üé® –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</div>
            <div class="coin-display">
                <span class="coin-icon">ü™ô</span>
                <span id="shopCoins">0</span>
            </div>
            <div class="skins-grid" id="skinsGrid">
                <!-- –°–∫–∏–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            <div class="action-buttons">
                <button class="action-btn primary" onclick="showScreen('mainMenu')">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø–∞—É–∑—ã -->
    <div class="pause-screen" id="pauseScreen">
        <div class="pause-menu">
            <div class="pause-title">–ü–∞—É–∑–∞</div>
            <div class="pause-buttons">
                <button class="action-btn primary" onclick="togglePause()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                <button class="action-btn" onclick="restartGame()">–ó–∞–Ω–æ–≤–æ</button>
                <button class="action-btn" onclick="exitToMenu()">–í –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã -->
    <div class="game-over-screen" id="gameOverScreen">
        <div class="game-over-menu">
            <div class="game-over-title">GAME OVER</div>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-value" id="finalScore">0</span>
                    <span class="stat-label">–°—á–µ—Ç</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="bestScore">0</span>
                    <span class="stat-label">–†–µ–∫–æ—Ä–¥</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="coinsEarned">0</span>
                    <span class="stat-label">–ú–æ–Ω–µ—Ç—ã</span>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-btn primary" onclick="restartGame()">üîÑ –ï—â–µ —Ä–∞–∑</button>
                <button class="action-btn" onclick="shareScore()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button class="action-btn" onclick="exitToMenu()">üè† –í –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="settings-screen" id="settingsScreen">
        <div class="settings-menu">
            <div class="pause-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="theme-selector">
                <button class="theme-btn active" onclick="changeTheme('classic')">–ö–ª–∞—Å—Å–∏–∫–∞</button>
                <button class="theme-btn" onclick="changeTheme('neon')">–ù–µ–æ–Ω</button>
                <button class="theme-btn" onclick="changeTheme('pastel')">–ü–∞—Å—Ç–µ–ª—å</button>
                <button class="theme-btn" onclick="changeTheme('dark')">–¢–µ–º–Ω–∞—è</button>
            </div>
            <div class="pause-buttons">
                <button class="action-btn primary" onclick="showScreen('mainMenu')">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
        const config = {
            gridSize: 20,
            initialSpeed: 150,
            themes: {
                classic: { background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                neon: { background: 'linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%)' },
                pastel: { background: 'linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%)' },
                dark: { background: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)' }
            }
        };

        // –°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–Ω–æ–≤
        const skins = [
            { id: 'classic', name: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', emoji: 'üêç', price: 0, color: '#4ECDC4' },
            { id: 'neon', name: '–ù–µ–æ–Ω–æ–≤—ã–π', emoji: 'üåü', price: 50, color: '#ff6b6b' },
            { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', emoji: 'ü•á', price: 100, color: '#FFD700' },
            { id: 'ice', name: '–õ–µ–¥—è–Ω–æ–π', emoji: '‚ùÑÔ∏è', price: 75, color: '#87CEEB' },
            { id: 'fire', name: '–û–≥–Ω–µ–Ω–Ω—ã–π', emoji: 'üî•', price: 80, color: '#FF4500' },
            { id: 'rainbow', name: '–†–∞–¥—É–∂–Ω—ã–π', emoji: 'üåà', price: 150, color: '#ff6b6b' },
            { id: 'phantom', name: '–§–∞–Ω—Ç–æ–º', emoji: 'üëª', price: 120, color: '#9370DB' },
            { id: 'robot', name: '–†–æ–±–æ—Ç', emoji: 'ü§ñ', price: 90, color: '#708090' },
            { id: 'crystal', name: '–ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π', emoji: 'üíé', price: 200, color: '#00FFFF' },
            { id: 'galaxy', name: '–ì–∞–ª–∞–∫—Ç–∏–∫–∞', emoji: 'üåå', price: 180, color: '#1a2a6c' }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            snake: [],
            food: {x: 10, y: 10},
            direction: 'right',
            nextDirection: 'right',
            score: 0,
            coins: 0,
            sessionCoins: 0,
            totalCoins: 0,
            bestScore: 0,
            gameSpeed: config.initialSpeed,
            isPaused: false,
            gameLoop: null,
            currentTheme: 'classic',
            currentSkin: 'classic',
            ownedSkins: ['classic']
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const elements = {
            mainMenu: document.getElementById('mainMenu'),
            gameScreen: document.getElementById('gameScreen'),
            pauseScreen: document.getElementById('pauseScreen'),
            gameOverScreen: document.getElementById('gameOverScreen'),
            settingsScreen: document.getElementById('settingsScreen'),
            shopScreen: document.getElementById('shopScreen'),
            canvas: document.getElementById('gameCanvas'),
            currentScore: document.getElementById('currentScore'),
            currentCoins: document.getElementById('currentCoins'),
            totalCoins: document.getElementById('totalCoins'),
            shopCoins: document.getElementById('shopCoins'),
            finalScore: document.getElementById('finalScore'),
            bestScore: document.getElementById('bestScore'),
            coinsEarned: document.getElementById('coinsEarned'),
            particles: document.getElementById('particles'),
            skinsGrid: document.getElementById('skinsGrid')
        };

        let ctx = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas
            if (elements.canvas) {
                ctx = elements.canvas.getContext('2d');
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            loadSavedData();
            
            resizeCanvas();
            updateCoinDisplay();
            renderShop();
            window.addEventListener('resize', resizeCanvas);
            
            console.log('–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        function loadSavedData() {
            try {
                gameState.totalCoins = parseInt(localStorage.getItem('snakeTotalCoins')) || 0;
                gameState.bestScore = parseInt(localStorage.getItem('snakeBestScore')) || 0;
                gameState.currentSkin = localStorage.getItem('snakeCurrentSkin') || 'classic';
                
                const savedSkins = localStorage.getItem('snakeOwnedSkins');
                gameState.ownedSkins = savedSkins ? JSON.parse(savedSkins) : ['classic'];
                
                console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', gameState);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                // –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
                gameState.totalCoins = 0;
                gameState.bestScore = 0;
                gameState.currentSkin = 'classic';
                gameState.ownedSkins = ['classic'];
            }
        }

        function saveGameData() {
            try {
                localStorage.setItem('snakeTotalCoins', gameState.totalCoins.toString());
                localStorage.setItem('snakeBestScore', gameState.bestScore.toString());
                localStorage.setItem('snakeCurrentSkin', gameState.currentSkin);
                localStorage.setItem('snakeOwnedSkins', JSON.stringify(gameState.ownedSkins));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        function resizeCanvas() {
            const board = document.querySelector('.game-board');
            if (board && elements.canvas) {
                elements.canvas.width = board.clientWidth;
                elements.canvas.height = board.clientHeight;
                console.log('Canvas —Ä–∞–∑–º–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', elements.canvas.width, 'x', elements.canvas.height);
            }
        }

        function resetGame() {
            console.log('–°–±—Ä–æ—Å –∏–≥—Ä—ã...');
            
            // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            if (gameState.gameLoop) {
                clearInterval(gameState.gameLoop);
                gameState.gameLoop = null;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–º–µ–π–∫–∏
            gameState.snake = [
                {x: 5, y: 10},
                {x: 4, y: 10},
                {x: 3, y: 10}
            ];
            
            gameState.direction = 'right';
            gameState.nextDirection = 'right';
            gameState.score = 0;
            gameState.coins = 0;
            gameState.sessionCoins = 0;
            gameState.gameSpeed = config.initialSpeed;
            gameState.isPaused = false;
            
            if (elements.currentScore) elements.currentScore.textContent = '0';
            if (elements.currentCoins) elements.currentCoins.textContent = '0';
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–¥—ã
            generateFood();
            
            drawGame();
            console.log('–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞');
        }

        function generateFood() {
            if (!elements.canvas) return;
            
            const gridWidth = Math.floor(elements.canvas.width / config.gridSize);
            const gridHeight = Math.floor(elements.canvas.height / config.gridSize);
            
            let newFood;
            let foodIsValid = false;
            let attempts = 0;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –µ–¥—É, –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–º –ø–æ–∑–∏—Ü–∏—é, –Ω–µ –∑–∞–Ω—è—Ç—É—é –∑–º–µ–π–∫–æ–π
            while (!foodIsValid && attempts < 100) {
                newFood = {
                    x: Math.floor(Math.random() * (gridWidth - 4)) + 2,
                    y: Math.floor(Math.random() * (gridHeight - 4)) + 2
                };
                
                foodIsValid = true;
                for (let segment of gameState.snake) {
                    if (segment.x === newFood.x && segment.y === newFood.y) {
                        foodIsValid = false;
                        break;
                    }
                }
                attempts++;
            }
            
            gameState.food = newFood;
        }

        function drawGame() {
            if (!ctx || !elements.canvas) {
                console.log('Canvas –Ω–µ –≥–æ—Ç–æ–≤');
                return;
            }
            
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, elements.canvas.width, elements.canvas.height);

            // –†–∏—Å—É–µ–º –∑–º–µ–π–∫—É
            const currentSkin = skins.find(skin => skin.id === gameState.currentSkin) || skins[0];
            gameState.snake.forEach((segment, index) => {
                const isHead = index === 0;
                const x = segment.x * config.gridSize;
                const y = segment.y * config.gridSize;
                
                ctx.fillStyle = isHead ? currentSkin.color : lightenColor(currentSkin.color, -20);
                ctx.fillRect(x, y, config.gridSize, config.gridSize);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—É—Ä –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.strokeRect(x, y, config.gridSize, config.gridSize);
            });

            // –†–∏—Å—É–µ–º –µ–¥—É
            const foodX = gameState.food.x * config.gridSize;
            const foodY = gameState.food.y * config.gridSize;
            ctx.fillStyle = '#FF6B6B';
            ctx.beginPath();
            ctx.arc(foodX + config.gridSize/2, foodY + config.gridSize/2, config.gridSize/2, 0, Math.PI * 2);
            ctx.fill();
        }

        function moveSnake() {
            if (gameState.isPaused || !gameState.gameLoop) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            gameState.direction = gameState.nextDirection;

            const head = {...gameState.snake[0]};
            
            // –î–≤–∏–≥–∞–µ–º –≥–æ–ª–æ–≤—É
            switch(gameState.direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏
            const gridWidth = Math.floor(elements.canvas.width / config.gridSize);
            const gridHeight = Math.floor(elements.canvas.height / config.gridSize);
            
            if (head.x < 0 || head.x >= gridWidth || head.y < 0 || head.y >= gridHeight) {
                gameOver();
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
            for (let i = 0; i < gameState.snake.length; i++) {
                if (head.x === gameState.snake[i].x && head.y === gameState.snake[i].y) {
                    gameOver();
                    return;
                }
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≥–æ–ª–æ–≤—É
            gameState.snake.unshift(head);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—ä–µ–¥–∞–Ω–∏—è –µ–¥—ã
            if (head.x === gameState.food.x && head.y === gameState.food.y) {
                gameState.score += 10;
                if (elements.currentScore) elements.currentScore.textContent = gameState.score;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã
                const coinsEarned = Math.floor(Math.random() * 3) + 1;
                gameState.coins += coinsEarned;
                gameState.sessionCoins += coinsEarned;
                if (elements.currentCoins) elements.currentCoins.textContent = gameState.coins;
                
                // –ù–æ–≤–∞—è –µ–¥–∞
                generateFood();
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 50 –æ—á–∫–æ–≤
                if (gameState.score % 50 === 0 && gameState.gameSpeed > 50) {
                    gameState.gameSpeed -= 10;
                    clearInterval(gameState.gameLoop);
                    gameState.gameLoop = setInterval(moveSnake, gameState.gameSpeed);
                }
            } else {
                // –£–¥–∞–ª—è–µ–º —Ö–≤–æ—Å—Ç –µ—Å–ª–∏ –Ω–µ —Å—ä–µ–ª–∏ –µ–¥—É
                gameState.snake.pop();
            }

            drawGame();
        }

        function gameOver() {
            console.log('Game Over!');
            if (gameState.gameLoop) {
                clearInterval(gameState.gameLoop);
                gameState.gameLoop = null;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–æ–Ω–µ—Ç—ã
            gameState.totalCoins += gameState.coins;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
            if (gameState.score > gameState.bestScore) {
                gameState.bestScore = gameState.score;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveGameData();
            updateCoinDisplay();
            
            if (elements.finalScore) elements.finalScore.textContent = gameState.score;
            if (elements.bestScore) elements.bestScore.textContent = gameState.bestScore;
            if (elements.coinsEarned) elements.coinsEarned.textContent = gameState.sessionCoins;
            
            showScreen('gameOverScreen');
        }

        function startGame() {
            console.log('–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
            resetGame();
            showScreen('gameScreen');
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            if (gameState.gameLoop) {
                clearInterval(gameState.gameLoop);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameState.gameLoop = setInterval(moveSnake, gameState.gameSpeed);
            console.log('–ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –∑–∞–ø—É—â–µ–Ω');
        }

        function restartGame() {
            console.log('–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã');
            startGame();
        }

        function exitToMenu() {
            console.log('–í—ã—Ö–æ–¥ –≤ –º–µ–Ω—é');
            if (gameState.gameLoop) {
                clearInterval(gameState.gameLoop);
                gameState.gameLoop = null;
            }
            showScreen('mainMenu');
        }

        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            if (gameState.isPaused) {
                showScreen('pauseScreen');
            } else {
                showScreen('gameScreen');
            }
        }

        function changeDirection(newDirection) {
            const opposites = {
                up: 'down',
                down: 'up',
                left: 'right',
                right: 'left'
            };
            
            // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞
            if (opposites[newDirection] !== gameState.direction) {
                gameState.nextDirection = newDirection;
            }
        }

        function changeTheme(themeName) {
            if (!config.themes[themeName]) return;
            
            gameState.currentTheme = themeName;
            document.body.style.background = config.themes[themeName].background;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –ø–æ —Ç–µ–∫—Å—Ç—É
            const themeButtons = document.querySelectorAll('.theme-btn');
            for (let btn of themeButtons) {
                if (btn.textContent.toLowerCase().includes(themeName)) {
                    btn.classList.add('active');
                    break;
                }
            }
        }

        // –°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–Ω–æ–≤
        function renderShop() {
            if (!elements.skinsGrid) return;
            
            elements.skinsGrid.innerHTML = '';
            if (elements.shopCoins) elements.shopCoins.textContent = gameState.totalCoins;
            
            skins.forEach(skin => {
                const isOwned = gameState.ownedSkins.includes(skin.id);
                const isEquipped = gameState.currentSkin === skin.id;
                
                const skinCard = document.createElement('div');
                skinCard.className = `skin-card ${isOwned ? 'owned' : ''} ${isEquipped ? 'equipped' : ''}`;
                
                skinCard.innerHTML = `
                    <div class="skin-preview" style="background: ${skin.color}">
                        ${skin.emoji}
                    </div>
                    <div class="skin-name">${skin.name}</div>
                    <div class="skin-price">
                        ${!isOwned ? `<span class="coin-icon">ü™ô</span> ${skin.price}` : '‚úÖ –ö—É–ø–ª–µ–Ω'}
                    </div>
                    <div class="skin-actions">
                        ${isOwned ? 
                            `<button class="skin-btn equip ${isEquipped ? 'active' : ''}" onclick="equipSkin('${skin.id}')">
                                ${isEquipped ? '‚úÖ –ù–∞–¥–µ—Ç' : '–ù–∞–¥–µ—Ç—å'}
                            </button>` :
                            `<button class="skin-btn buy" onclick="buySkin('${skin.id}')" ${gameState.totalCoins < skin.price ? 'disabled' : ''}>
                                –ö—É–ø–∏—Ç—å
                            </button>`
                        }
                    </div>
                `;
                
                elements.skinsGrid.appendChild(skinCard);
            });
        }

        function buySkin(skinId) {
            const skin = skins.find(s => s.id === skinId);
            if (!skin) return;
            
            if (gameState.totalCoins >= skin.price) {
                gameState.totalCoins -= skin.price;
                gameState.ownedSkins.push(skinId);
                
                saveGameData();
                updateCoinDisplay();
                renderShop();
                
                equipSkin(skinId);
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
            }
        }

        function equipSkin(skinId) {
            gameState.currentSkin = skinId;
            saveGameData();
            renderShop();
        }

        function updateCoinDisplay() {
            if (elements.totalCoins) elements.totalCoins.textContent = gameState.totalCoins;
            if (elements.shopCoins) elements.shopCoins.textContent = gameState.totalCoins;
        }

        function showScreen(screenName) {
            console.log('–ü–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞:', screenName);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            const screens = ['mainMenu', 'gameScreen', 'pauseScreen', 'gameOverScreen', 'settingsScreen', 'shopScreen'];
            screens.forEach(screen => {
                const element = document.getElementById(screen);
                if (element) element.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            const targetScreen = document.getElementById(screenName);
            if (targetScreen) {
                targetScreen.style.display = 'flex';
            }
            
            if (screenName === 'shopScreen') {
                renderShop();
            }
            
            if (screenName === 'gameScreen') {
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –∏–≥—Ä–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
                setTimeout(() => {
                    resizeCanvas();
                    drawGame();
                }, 50);
            }
        }

        function showRecords() {
            alert(`üèÜ –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${gameState.bestScore}\nü™ô –í—Å–µ–≥–æ –º–æ–Ω–µ—Ç: ${gameState.totalCoins}`);
        }

        function shareScore() {
            if (navigator.share) {
                navigator.share({
                    title: '–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ó–º–µ–π–∫–µ',
                    text: `–Ø –Ω–∞–±—Ä–∞–ª ${gameState.score} –æ—á–∫–æ–≤ –≤ –∏–≥—Ä–µ –ó–º–µ–π–∫–∞! üêç`,
                    url: window.location.href
                });
            } else {
                alert(`üéØ –°—á–µ—Ç: ${gameState.score}\nü™ô –ú–æ–Ω–µ—Ç—ã: ${gameState.sessionCoins}\n–ü–æ–ø—Ä–æ–±—É–π –ø–æ–±–∏—Ç—å –º–æ–π —Ä–µ–∫–æ—Ä–¥!`);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function lightenColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = Math.min(255, Math.max(0, (num >> 16) + amt));
            const G = Math.min(255, Math.max(0, (num >> 8 & 0x00FF) + amt));
            const B = Math.min(255, Math.max(0, (num & 0x0000FF) + amt));
            return "#" + ((1 << 24) + (R << 16) + (G << 8) + B).toString(16).slice(1);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', initGame);
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            if (!elements.gameScreen || elements.gameScreen.style.display !== 'flex') return;
            
            switch(e.key) {
                case 'ArrowUp': case 'w': case '—Ü': changeDirection('up'); break;
                case 'ArrowDown': case 's': case '—ã': changeDirection('down'); break;
                case 'ArrowLeft': case 'a': case '—Ñ': changeDirection('left'); break;
                case 'ArrowRight': case 'd': case '–≤': changeDirection('right'); break;
                case ' ': case 'Escape': togglePause(); break;
            }
        });
    </script>
</body>
</html>
